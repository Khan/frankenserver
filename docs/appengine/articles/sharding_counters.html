
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


















 
 
 
 
 
  
  


<html>
  <head>
    <script type="text/javascript" language="JavaScript">
    ORIGINAL_PAGE_PATH = "/appengine/articles/sharding_counters.html";
    </script>
    
    
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
<title>Sharding counters - Google App Engine - Google Code</title>
<script type="text/javascript"><!--
(function(){function a(){this.t={};this.tick=function(c){this.t[c]=(new Date).getTime()};this.tick("start")}var b=new a;window.jstiming={Timer:a,load:b};if(window.external&&window.external.pageT)window.jstiming.pt=window.external.pageT;})();

var _tocPath_ = '/appengine/docs/_toc.ezt';
var codesite_token = null;
var logged_in_user_email = null;
//--></script>
<link href="../../css/codesite.pack.04102009.css" type="text/css" rel="stylesheet">
<script src="../../js/codesite_head.pack.04102009.js" type="text/javascript"></script>
<script type="text/javascript">CODESITE_CSITimer['load'].tick('bhs');</script>
<link rel="search" type="application/opensearchdescription+xml" title="Google Code" href="http://code.google.com/osd.xml">

<!--[if IE]><link rel="stylesheet" type="text/css" href="../../css/iehacks.css"><![endif]-->

    <link href="../../css/semantic_headers.css" rel="stylesheet" type="text/css" />
    <link href="../css/local_extensions.css" rel="stylesheet" type="text/css" />
    <script src="../js/customtabs.js" type="text/javascript"></script>
    <script src="../js/ui.tabs.js" type="text/javascript"></script>
  </head>

  <body class="gc-documentation">

    
    
    <script type="text/javascript">
var _gaq = _gaq || [];

var cookiePath = '/appengine/';
if (cookiePath.lastIndexOf('.html') > cookiePath.lastIndexOf('/')) {
  cookiePath = cookiePath.substring(0, cookiePath.lastIndexOf('/') + 1);
};

_gaq.push(


    ['siteTracker._setAccount', 'UA-18071-1'],
    ['siteTracker._setDomainName', 'code.google.com'],
    ['siteTracker._trackPageview']
);
(function() {
  var ga = document.createElement('script');
  ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] ||
   document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
</script>


<div id="gb">
 <span>
  
    <a id="lang-dropdown" href="http://code.google.com" onclick="return false;"><span style="text-decoration:underline">English</span> <span style="font-size:.75em;">&#9660;</span></a>
  
 </span>
</div>

<div class="gbh" style="left:0px;"></div>
<div class="gbh" style="right:0px;"></div>


<div id="gc-container">
<a id="top"></a>
<div id="skipto">
  <a href="#gc-pagecontent-anchor">Skip to page content</a>
  <a href="#gc-toc-anchor">Skip to main navigation</a>
</div>

<div id="gc-header">
  <div id="logo"><a href="http://code.google.com">
  
     <img src="../../images/code_logo.gif" height="40" width="167" alt="Google Code" style="border:0;margin:3px 0 0 0;">
  
  </a></div>
  <div id="search">
    <div id="searchForm">
      <form id="cse" action="http://www.google.com/cse" accept-charset="utf-8" onsubmit="executeGSearch(document.getElementById('gsearchInput').value); return false;">
      <noscript>
      <input type="hidden" name="cref" value="http://code.google.com/cse/googlecode-context.xml">
      </noscript>
      <div id="gsc-search-box">
        <input id="gsearchInput" type="text" name="q" maxlength="2048" class="gsc-input" autocomplete="off" title="Google Code Search" style="width:345px">
        <div id="cs-searchresults" onclick="event.cancelBubble = true;"></div>
        <input title="Search" id="gsearchButton" class="gsc-search-button" name="sa" value="Search" type="submit">
        <div class="greytext">e.g. "templates" or "datastore"</div>
      </div>
      </form>
    </div> <!-- end searchForm -->
  </div> <!-- end search -->




</div> <!-- end gc-header -->


<div id="codesiteContent">

<a id="gc-topnav-anchor"></a>
<div id="gc-topnav">
  <h1 style="padding:0 0 0 6px;">Google App Engine</h1>
  <ul id="articles" class="gc-topnav-tabs">

    <li id="home_link">
      <a href="../index.html" title="Google App Engine home page">Home</a>
    </li>
  
    <li id="docs_link">
      <a href="../docs/index.html" title="Official Google App Engine documentation">Docs</a>
    </li>
  
    <li id="faq_link">
      <a href="../kb/index.html" title="Answers to frequently asked questions about Google App Engine">FAQ</a>
    </li>
  
    <li id="articles_link">
      <a href="index.html" class="selected" title="Focused articles and tutorials for Google App Engine developers">Articles</a>
    </li>
  
    <li>
      <a href="http://googleappengine.blogspot.com/" title="Official Google App Engine blog">Blog</a>
    </li>
  
    <li>
      <a href="../community.html" title="Community home for Google App Engine">Community</a>
    </li>
  
    <li>
      <a href="../terms.html" title="Google App Engine terms of service">Terms</a>
    </li>
  
    <li>
      <a href="../downloads.html" title="Download Google App Engine">Download</a>
    </li>
  

  
  
  
  
  <li><g:plusone size="small" count="false" source="google:googlecode"></g:plusone>&nbsp;</li>
</ul>
</div> <!-- end gc-topnav -->


    <div class="g-section g-tpl-170">

      <a name="gc-toc-anchor"></a>  
      <div class="g-unit g-first" id="gc-toc">
        <ul>
  <li><a href="../downloads.html">Downloads</a></li>
  <li><a href="../tools_tips.html">Tools and Tips</a></li>
  <li><a href="../docs/glossary.html">Glossary</a><sup class="new">New!</sup></li>
  <li><a href="https://appengine.google.com/">Admin Console</a></li>
  <li><a href="http://code.google.com/status/appengine">System Status</a></li>
  <li><a href="http://code.google.com/p/googleappengine/issues/list">Issue Tracker</a></li>
</ul>
<div class="line"></div>
<ul>
  <li><h2>Getting Started</h2>
    <ul>
      <li><a href="../docs/whatisgoogleappengine.html">What Is Google App Engine?</a></li>
      <li><a href="../docs/java/gettingstarted/index.html">Java</a>
        <ul>
              <li><a href="../docs/java/gettingstarted/introduction.html">Introduction</a></li>
    <li><a href="../docs/java/gettingstarted/installing.html">Installing the Java SDK</a></li>
    <li><a href="../docs/java/gettingstarted/creating.html">Creating a Project</a></li>
    <li><a href="../docs/java/gettingstarted/usingusers.html">Using the Users Service</a></li>
    <li><a href="../docs/java/gettingstarted/usingjsps.html">Using JSPs</a></li>
    <li><a href="../docs/java/gettingstarted/usingdatastore.html">Using the Datastore</a></li>
    <li><a href="../docs/java/gettingstarted/staticfiles.html">Using Static Files</a></li>
    <li><a href="../docs/java/gettingstarted/uploading.html">Uploading Your Application</a></li>
    <li><a href="http://googcloudlabs.appspot.com">Codelabs for Getting Started in Java</a></li>

        </ul>
      </li>
      <li><a href="../docs/python/gettingstarted/index.html">Python 2.5</a>
        <ul>
            <li><a href="../docs/python/gettingstarted/introduction.html">Introduction</a></li>
  <li><a href="../docs/python/gettingstarted/devenvironment.html">The Development Environment</a></li>
  <li><a href="../docs/python/gettingstarted/helloworld.html">Hello, World!</a></li>
  <li><a href="../docs/python/gettingstarted/usingwebapp.html">Using the webapp Framework</a></li>
  <li><a href="../docs/python/gettingstarted/usingusers.html">Using the Users Service</a></li>
  <li><a href="../docs/python/gettingstarted/handlingforms.html">Handling Forms With webapp</a></li>
  <li><a href="../docs/python/gettingstarted/usingdatastore.html">Using the Datastore</a></li>
  <li><a href="../docs/python/gettingstarted/templates.html">Using Templates</a></li>
  <li><a href="../docs/python/gettingstarted/staticfiles.html">Using Static Files</a></li>
  <li><a href="../docs/python/gettingstarted/uploading.html">Uploading Your Application</a></li>

        </ul>
      </li>
      <li><a href="../docs/python/gettingstartedpython27/index.html">Python 2.7</a>
        <ul>
            <li><a href="../docs/python/gettingstartedpython27/introduction.html">Introduction</a></li>
  <li><a href="../docs/python/gettingstartedpython27/devenvironment.html">The Development Environment</a></li>
  <li><a href="../docs/python/gettingstartedpython27/helloworld.html">Hello, World!</a></li>
  <li><a href="../docs/python/gettingstartedpython27/usingwebapp.html">Explaining the webapp2 Framework</a></li>
  <li><a href="../docs/python/gettingstartedpython27/usingusers.html">Using the Users Service</a></li>
  <li><a href="../docs/python/gettingstartedpython27/handlingforms.html">Handling Forms With webapp</a></li>
  <li><a href="../docs/python/gettingstartedpython27/usingdatastore.html">Using the Datastore</a></li>
  <li><a href="../docs/python/gettingstartedpython27/templates.html">Using Templates</a></li>
  <li><a href="../docs/python/gettingstartedpython27/staticfiles.html">Using Static Files</a></li>
  <li><a href="../docs/python/gettingstartedpython27/uploading.html">Uploading Your Application</a></li>

        </ul>
      </li>
      <li><a href="../docs/go/gettingstarted/index.html">Go</a>
        <ul>
          <li><span class="exp-feat">Experimental!</span></li>
            <li><a href="../docs/go/gettingstarted/introduction.html">Introduction</a></li>
  <li><a href="../docs/go/gettingstarted/devenvironment.html">The Development Environment</a></li>
  <li><a href="../docs/go/gettingstarted/helloworld.html">Hello, World!</a></li>
  <li><a href="../docs/go/gettingstarted/usingusers.html">Using the Users Service</a></li>
  <li><a href="../docs/go/gettingstarted/handlingforms.html">Handling Forms</a></li>
  <li><a href="../docs/go/gettingstarted/usingdatastore.html">Using the Datastore</a></li>
  <li><a href="../docs/go/gettingstarted/uploading.html">Uploading Your Application</a></li>

        </ul>
      </li>
    </ul>
  </li>
</ul>
<div class="line"></div>
<ul>
  <li><h2>Java</h2>
    <ul>
          <li><a href="../docs/java/overview.html">Overview</a></li>
    <li><a href="../docs/java/runtime.html">Servlet Environment</a></li>
    <li><a href="../docs/java/backends/index.html">Backends</a>
      <ul>
        <li><a href="../docs/java/backends/overview.html">Overview</a></li>
<li><a href="../docs/java/javadoc/com/google/appengine/api/backends/package-summary.html">Javadoc Reference</a></li>


      </ul>
    </li>
    <li><a href="../docs/java/datastore/index.html">Storing Data</a>
      <ul>
            <li><a href="../docs/java/datastore/overview.html">Overview</a></li>
    <li><a href="../docs/java/datastore/entities.html">Entities</a></li>
    <li><a href="../docs/java/datastore/queries.html">Queries</a></li>
    <li><a href="../docs/java/datastore/transactions.html">Transactions</a></li>
    <li><a href="../docs/java/datastore/hr/index.html">Choosing a Datastore</a></li>
    <li><a href="../docs/java/datastore/hr/overview.html">Using the High Replication Datastore</a></li>
    <li><a href="../docs/java/datastore/metadataqueries.html">Metadata Queries</a></li>
    <li><a href="../docs/java/datastore/stats.html">Statistics</a></li>
    <li><a href="../docs/java/datastore/async.html">Async API</a></li>
    <li><a href="../docs/java/datastore/callbacks.html">Callbacks</a></li>
    <li><a href="../docs/java/datastore/jdo/index.html">JDO</a>
      <ul>
            <li><a href="../docs/java/datastore/jdo/overview.html">Overview</a></li>
    <li><a href="../docs/java/datastore/jdo/dataclasses.html">Defining Data Classes with JDO</a></li>
    <li><a href="../docs/java/datastore/jdo/creatinggettinganddeletingdata.html">Creating, Getting, and Deleting Data in JDO</a></li>
    <li><a href="../docs/java/datastore/jdo/relationships.html">Entity Relationships in JDO</a></li>
    <li><a href="../docs/java/datastore/jdo/queries.html">Queries in JDO</a></li>

      </ul>
    </li>
    <li><a href="../docs/java/datastore/jpa/index.html">JPA</a>
      <ul>
            <li><a href="../docs/java/datastore/jpa/overview.html">Overview</a></li>

      </ul>
    </li>
    <li><a href="../docs/java/javadoc/com/google/appengine/api/datastore/package-summary.html">Javadoc Reference</a></li>

      </ul>
    </li>
    <li><a href="../docs/java/apis.html">Services</a>
      <ul>
        <li><a href="../docs/java/appidentity/index.html">App Identity</a>
          <ul>
            <li><a href="../docs/java/appidentity/overview.html">Overview</a></li>

<li><a href="../docs/java/javadoc/com/google/appengine/api/appidentity/package-summary.html">Low-level API</a></li>

          </ul>
        </li>
        <li><a href="../docs/java/blobstore/index.html">Blobstore</a>
          <ul>
            <li><a href="../docs/java/blobstore/overview.html">Overview</a></li>
<li><span class="tlw-title tlw-expanded">Reference</span>
  <ul>
    <li><a href="../docs/java/javadoc/com/google/appengine/api/blobstore/package-summary.html">API Reference</a></li>
  </ul>
</li>

          </ul>
        </li>
        <li><a href="../docs/java/googlestorage/index.html">Google Cloud Storage</a>
          <ul>
            <li><a href="../docs/java/googlestorage/overview.html">Overview</a></li>
<li><a href="../docs/java/javadoc/com/google/appengine/api/files/package-summary.html">API Reference</a></li>
    </li>


          </ul>
        </li>
        <li><a href="../docs/java/capabilities/index.html">Capabilities</a>
          <ul>
            <li><a href="../docs/java/capabilities/overview.html">Overview</a></li>
<li><a href="../docs/java/javadoc/com/google/appengine/api/capabilities/package-summary.html">Javadoc Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/java/conversion/index.html">Conversion</a>
          <ul>
            <li><a href="../docs/java/conversion/overview.html">Overview</a></li>
<li><a href="../docs/java/javadoc/com/google/appengine/api/conversion/package-summary.html">Javadoc Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/java/channel/index.html">Channel</a>
          <ul>
            <li><a href="../docs/java/channel/overview.html">Overview</a></li>
<li><a href="../docs/java/javadoc/com/google/appengine/api/channel/package-summary.html">Javadoc Reference</a></li>
<li><a href="../docs/java/channel/javascript.html">JavaScript Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/java/images/index.html">Images</a>
          <ul>
                <li><a href="../docs/java/images/overview.html">Overview</a></li>
    <li><a href="../docs/java/javadoc/com/google/appengine/api/images/package-summary.html">API Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/java/mail/index.html">Mail</a>
          <ul>
                <li><a href="../docs/java/mail/overview.html">Overview</a></li>
    <li><a href="../docs/java/mail/usingjavamail.html">Using JavaMail to Send Mail</a></li>
    <li><a href="../docs/java/mail/receiving.html">Receiving Mail</a></li>
    <li><a href="../docs/java/javadoc/com/google/appengine/api/mail/package-summary.html">Low-level API</a></li>

          </ul>
        </li>
        <li><a href="../docs/java/memcache/index.html">Memcache</a>
          <ul>
                <li><a href="../docs/java/memcache/overview.html">Overview</a></li>
    <li><a href="../docs/java/memcache/usingjcache.html">Using JCache</a></li>
    <li><a href="../docs/java/javadoc/com/google/appengine/api/memcache/package-summary.html">Low-level API</a></li>

          </ul>
        </li>
        <li><a href="../docs/java/multitenancy/index.html">Multitenancy</a>
          <ul>
                  <li><a href="../docs/java/multitenancy/overview.html">Overview</a></li>
    <li><a href="../docs/java/multitenancy/multitenancy.html">Multitenancy with Namespaces</a></li>
    <li><a href="../docs/java/multitenancy/namespaces.html">Other Uses for Namespaces</a></li>
    <li><a href="../docs/java/javadoc/com/google/appengine/api/NamespaceManager.html">API Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/java/oauth/index.html">OAuth</a>
          <ul>
                <li><a href="../docs/java/oauth/overview.html">Overview</a></li>
    <li><a href="../docs/java/javadoc/com/google/appengine/api/oauth/package-summary.html">API Reference</a></li>


          </ul>
        </li>
        <li><a href="../docs/java/prospectivesearch/index.html">Prospective Search</a>
          <ul>
            <li><a href="../docs/java/prospectivesearch/overview.html">Overview</a></li>
<li><a href="../docs/java/javadoc/com/google/appengine/api/prospectivesearch/package-summary.html">Javadoc Reference</a></li>

          </ul>
        </li>
        </li>
        <li><a href="../docs/java/taskqueue/index.html">Task Queues</a>
          <ul>
                 <li><a href="../docs/java/taskqueue/overview.html">Overview</a></li>
     <li><a href="../docs/java/taskqueue/overview-push.html">Using Push Queues</a></li>
     <li><a href="../docs/java/taskqueue/overview-pull.html">Using Pull Queues</a><sup class="new">New!</sup></li>
     <li><a href="../docs/java/javadoc/com/google/appengine/api/taskqueue/package-summary.html">Javadoc Reference</a></li>
     <li><a href="../docs/java/taskqueue/rest.html">REST reference</a> <span class="exp-feat">(Experimental)</span></li>
          </ul>
        </li>
        <li><a href="../docs/java/urlfetch/index.html">URL Fetch</a>
          <ul>
                <li><a href="../docs/java/urlfetch/overview.html">Overview</a></li>
    <li><a href="../docs/java/urlfetch/usingjavanet.html">Using java.net</a></li>
    <li><a href="../docs/java/javadoc/com/google/appengine/api/urlfetch/package-summary.html">Low-level API</a></li>

          </ul>
        </li>
        <li><a href="../docs/java/users/index.html">Users</a>
          <ul>
                <li><a href="../docs/java/users/overview.html">Overview</a></li>
    <li><a href="../docs/java/javadoc/com/google/appengine/api/users/package-summary.html">API Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/java/xmpp/index.html">XMPP</a>
          <ul>
                 <li><a href="../docs/java/xmpp/overview.html">Overview</a></li>
     <li><a href="../docs/java/javadoc/com/google/appengine/api/xmpp/package-summary.html">API Reference</a></li>

          </ul>
        </li>
      </ul>
    </li>
    <li><a href="../docs/java/javadoc/index.html">Services Javadoc</a></li>
    <li><a href="../docs/java/jrewhitelist.html">JRE Class White List</a></li>
    <li><a href="../docs/java/config/index.html">Configuration</a>
      <ul>
            <li><a href="../docs/java/config/webxml.html">Deployment Descriptor</a></li>
    <li><a href="../docs/java/config/appconfig.html">App Config</a></li>
    <li><a href="../docs/java/config/backends.html">Backends Config</a></li>
    <li><a href="../docs/java/config/indexconfig.html">Index Config</a></li>
    <li><a href="../docs/java/config/cron.html">Scheduled Tasks</a></li>
    <li><a href="../docs/java/config/queue.html">Task Queue Config</a></li>
    <li><a href="../docs/java/config/dos.html">DoS Protection Config</a></li>

      </ul>
    </li>
    <li><a href="../docs/java/configyaml/index.html">YAML Configuration</a>
      <ul>
                <li><a href="../docs/java/configyaml/appconfig_yaml.html">YAML App Config</a></li>
        <li><a href="../docs/java/configyaml/backends.html">Backends Config</a></li>
        <li><a href="../docs/java/configyaml/indexconfig.html">Index Config</a></li>
        <li><a href="../docs/java/configyaml/cron.html">Scheduled Tasks</a></li>
        <li><a href="../docs/java/configyaml/queue.html">Task Queue Config</a></li>
        <li><a href="../docs/java/configyaml/dos.html">DoS Protection Config</a></li>

      </ul>
    </li>
    <li><a href="../docs/java/tools/index.html">Tools</a>
      <ul>
            <li><a href="../docs/java/tools/devserver.html">Development Server</a></li>
    <li><a href="../docs/java/tools/uploadinganapp.html">Uploading and Managing an App</a></li>
    <li><a href="../docs/java/tools/eclipse.html">Google Plugin for Eclipse</a></li>
    <li><a href="../docs/java/tools/ant.html">Using Apache Ant</a></li>
    <li><a href="../docs/java/tools/capabilities.html">Capabilities Service Test Configuration</a>
    <li><a href="../docs/java/tools/localunittesting.html">Local Unit Testing</a>
        <ul>
            <li><a href="../docs/java/tools/localunittesting/javadoc/index.html">Testing Javadoc</a></li>
        </ul>
    </li>
    <li><a href="../docs/java/tools/appstats.html">Appstats</a></li>
    <li><a href="../docs/java/tools/remoteapi.html">Remote API</a></li>

      </ul>
    </li>
    <li><a href="../docs/java/howto/index.html">How-To</a>
      <ul>
              <li><a href="../docs/java/howto/maintenance.html">Handling Scheduled Maintenance Periods</a></li>

      </ul>
    </li>

    </ul>
  </li>
</ul>
<div class="line"></div>
<ul>
  <li><h2>Python</h2>
    <ul>
          <li><a href="../docs/python/overview.html">Overview</a></li>
    <li><a href="../docs/python/runtime.html">Runtime Environment</a></li>
    <li><a href="../docs/python/python27/index.html">Python 2.7</a>
      <ul>
            <li><a href="../docs/python/python27/newin27.html">What's New in Python 2.7</a></li>
    <li><a href="../docs/python/python27/using27.html">Using Python 2.7</a></li>

      </ul>
    </li>
    <li><a href="../docs/python/backends/index.html">Backends</a>
      <ul>
        <li><a href="../docs/python/backends/overview.html">Overview</a></li>
<li><span class="tlw-title tlw-expanded">Reference</span>
  <ul>
    <li><a href="../docs/python/backends/functions.html">Backends API Functions</a></li>
    <li><a href="../docs/python/backends/exceptions.html">Backends API Exceptions</a></li>
    <li><a href="../docs/python/backends/logserviceapi.html">LogService API</a></li>
    <li><a href="../docs/python/backends/applog.html">AppLog Class</a></li>
    <li><a href="../docs/python/backends/requestlog.html">RequestLog Class</a></li>
    <li><a href="../docs/python/backends/runtimeapi.html">Runtime API</a></li>
  </ul>
</li>

      </ul>
    </li>
    <li><a href="../docs/python/datastore/index.html">Storing Data</a>
      <ul>
              <li><a href="../docs/python/datastore/overview.html">Datastore Overview</a></li>
      <li><a href="../docs/python/datastore/entities.html">Entities</a></li>
      <li><a href="../docs/python/datastore/queries.html">Queries</a></li>
      <li><a href="../docs/python/datastore/transactions.html">Transactions</a></li>
      <li><a href="../docs/python/datastore/datamodeling.html">Data Modeling</a></li>
      <li><a href="../docs/python/datastore/gqlreference.html">GQL Reference</a></li>
      <li><a href="../docs/python/datastore/hr/index.html">Choosing a Datastore</a></li>
      <li><a href="../docs/python/datastore/hr/overview.html">Using the High Replication Datastore</a></li>
      <li><a href="../docs/python/datastore/metadataqueries.html">Metadata Queries</a></li>
      <li><a href="../docs/python/datastore/stats.html">Statistics</a></li>
      <li><a href="../docs/python/datastore/async.html">Async API</a></li>
      <li><span class="tlw-title tlw-expanded">Reference</span>
        <ul>
          <li><a href="../docs/python/datastore/typesandpropertyclasses.html">Types and Property Classes</a></li>
          <li><a href="../docs/python/datastore/gqlreference.html">GQL Reference</a></li>
          <li><a href="../docs/python/datastore/modelclass.html">Model</a></li>
          <li><a href="../docs/python/datastore/expandoclass.html">Expando</a></li>
          <li><a href="../docs/python/datastore/polymodelclass.html">PolyModel</a></li>
          <li><a href="../docs/python/datastore/propertyclass.html">Property</a></li>
          <li><a href="../docs/python/datastore/queryclass.html">Query</a></li>
          <li><a href="../docs/python/datastore/gqlqueryclass.html">GqlQuery</a></li>
          <li><a href="../docs/python/datastore/metadataqueryclass.html">Metadata Query</a></li>
          <li><a href="../docs/python/datastore/keyclass.html">Key</a></li>
          <li><a href="../docs/python/datastore/functions.html">Functions</a></li>
          <li><a href="../docs/python/datastore/exceptions.html">Exceptions</a></li>
        </ul>
      </li>

      </ul>
    </li>
    <li><a href="../docs/python/dataprocessing/index.html">Data Processing</a>
      <ul>
             <li><a href="../docs/python/dataprocessing/overview.html">Overview</a></li>
     <li><a href="../docs/python/dataprocessing/helloworld.html">Hello World</a></li>
     <li><span class="tlw-title tlw-expanded">Reference</span>
       <ul>
         <li><a href="../docs/python/dataprocessing/mapreducepipelineclass.html">Mapreduce Pipline</a></li>
         <li><a href="../docs/python/dataprocessing/readers_writers.html">Standard Input Readers and Output Writers</a></li>
       </ul>
     </li>

      </ul>
    </li>
    <li><a href="../docs/python/apis.html">Services</a>
      <ul>
        <li><a href="../docs/python/appidentity/index.html">App Identity</a>
          <ul>
            <li><a href="../docs/python/appidentity/overview.html">Overview</a></li>
<li><span class="tlw-title tlw-expanded">Reference</span>
  <ul>
    <li><a href="../docs/python/appidentity/functions.html">Functions</a></li>
    <li><a href="../docs/python/appidentity/exceptions.html">Exceptions</a></li>
  </ul>
</li>

          </ul>
        </li>
        <li><a href="../docs/python/blobstore/index.html">Blobstore</a>
          <ul>
            <li><a href="../docs/python/blobstore/overview.html">Overview</a></li>
<li><span class="tlw-title tlw-expanded">Reference</span>
  <ul>
    <li><a href="../docs/python/blobstore/blobinfoclass.html">BlobInfo</a></li>
    <li><a href="../docs/python/blobstore/blobkeyclass.html">BlobKey</a></li>
    <li><a href="../docs/python/blobstore/blobreaderclass.html">BlobReader</a></li>
    <li><a href="../docs/python/blobstore/functions.html">Functions</a></li>
    <li><a href="../docs/python/blobstore/exceptions.html">Exceptions</a></li>
  </ul>
</li>

          </ul>
        </li>
        <li><a href="../docs/python/capabilities/index.html">Capabilities</a>
          <ul>
            <li><a href="../docs/python/capabilities/overview.html">Overview</a></li>
<li><span class="tlw-title tlw-expanded">Reference</span>
  <ul>
    <li><a href="../docs/python/capabilities/capabilitysetclass.html">CapabilitySet</a></li>
    <li><a href="../docs/python/capabilities/exceptions.html">Exceptions</a></li>
  </ul>
</li>

          </ul>
        </li>
        <li><a href="../docs/python/conversion/index.html">Conversion</a>
          <ul>
            <li><a href="../docs/python/conversion/overview.html">Overview</a></li>
<li><span class="tlw-title tlw-expanded">Reference</span>
  <ul>
    <li><a href="../docs/python/conversion/conversionclass.html">Conversion Class</a></li>
    <li><a href="../docs/python/conversion/propertyclasses.html">Property Classes</a></li>
    <li><a href="../docs/python/conversion/functions.html">Functions</a></li>
    <li><a href="../docs/python/conversion/exceptions.html">Exceptions</a></li>
  </ul>
</li>

          </ul>
        </li>
        <li><a href="../docs/python/channel/index.html">Channel</a>
          <ul>
            <li><a href="../docs/python/channel/overview.html">Overview</a></li>
<li><span class="tlw-title tlw-expanded">Reference</span>
  <ul>
    <li><a href="../docs/python/channel/functions.html">Functions</a></li>
    <li><a href="../docs/python/channel/exceptions.html">Exceptions</a></li>
    <li><a href="../docs/python/channel/javascript.html">Client Javascript Reference</a></li>
  </ul>
</li>

          </ul>
        </li>
        <li><a href="../docs/python/images/index.html">Images</a>
          <ul>
                 <li><a href="../docs/python/images/overview.html">Overview</a></li>
     <li><a href="../docs/python/images/installingPIL.html">Installing PIL</a></li>
     <li><a href="../docs/python/images/usingimages.html">Using the Images API</a></li>
     <li><span class="tlw-title tlw-expanded">Reference</span>
       <ul>
         <li><a href="../docs/python/images/imageclass.html">Image</a></li>
         <li><a href="../docs/python/images/functions.html">Functions</a></li>
         <li><a href="../docs/python/images/exceptions.html">Exceptions</a></li>
       </ul>
     </li>

          </ul>
        </li>
        <li><a href="../docs/python/mail/index.html">Mail</a>
          <ul>
                 <li><a href="../docs/python/mail/overview.html">Overview</a></li>
     <li><a href="../docs/python/mail/sendingmail.html">Sending Mail</a></li>
     <li><a href="../docs/python/mail/receivingmail.html">Receiving Mail</a></li>
     <li><a href="../docs/python/mail/attachments.html">Attachments</a></li>
     <li><a href="../docs/python/mail/headers.html">Headers</a></li>
     <li><span class="tlw-title tlw-expanded">Reference</span>
       <ul>
         <li><a href="../docs/python/mail/emailmessageclass.html">EmailMessage</a></li>
         <li><a href="../docs/python/mail/emailmessagefields.html">Message Fields</a></li>
         <li><a href="../docs/python/mail/functions.html">Functions</a></li>
         <li><a href="../docs/python/mail/exceptions.html">Exceptions</a></li>
       </ul>
     </li>

          </ul>
        </li>
        <li><a href="../docs/python/memcache/index.html">Memcache</a>
          <ul>
                 <li><a href="../docs/python/memcache/overview.html">Overview</a></li>
      <li><a href="../docs/python/memcache/usingmemcache.html">Using Memcache</a></li>
     <li><span class="tlw-title tlw-expanded">Reference</span>
       <ul>
         <li><a href="../docs/python/memcache/clientclass.html">Client</a></li>
         <li><a href="../docs/python/memcache/functions.html">Functions</a></li>
       </ul>
     </li>

          </ul>
        </li>
        <li><a href="../docs/python/multitenancy/index.html">Multitenancy</a>
          <ul>
                  <li><a href="../docs/python/multitenancy/overview.html">Overview</a></li>
    <li><a href="../docs/python/multitenancy/multitenancy.html">Multitenancy with Namespaces</a></li>
    <li><a href="../docs/python/multitenancy/namespaces.html">Other Uses for Namespaces</a></li>
    <li>Reference
      <ul>
        <li><a href="../docs/python/multitenancy/functions.html">Functions</a></li>
        <li><a href="../docs/python/multitenancy/exceptions.html">Exceptions</a></li>
      </ul>
    </li>

          </ul>
        </li>
        <li><a href="../docs/python/oauth/index.html">OAuth</a>
          <ul>
                 <li><a href="../docs/python/oauth/overview.html">Overview</a></li>
     <li><span class="tlw-title tlw-expanded">Reference</span>
       <ul>
         <li><a href="../docs/python/oauth/functions.html">Functions</a></li>
         <li><a href="../docs/python/oauth/exceptions.html">Exceptions</a></li>
       </ul>
     </li>

          </ul>
        </li>
        <li><a href="../docs/python/prospectivesearch/index.html">Prospective Search</a>
          <ul>
            <li><a href="../docs/python/prospectivesearch/overview.html">Overview</a></li>
<li><span class="tlw-title tlw-expanded">Reference</span>
  <ul>
    <li><a href="../docs/python/prospectivesearch/functions.html">Functions</a></li>
    <li><a href="../docs/python/prospectivesearch/exceptions.html">Exceptions</a></li>
  </ul>
</li> 

          </ul> 
        </li>
         <li><a href="../docs/python/googlestorage/index.html">Google Cloud Storage</a>
          <ul>
            <li><a href="../docs/python/googlestorage/overview.html">Overview</a></li>
<li><a href="../docs/python/googlestorage/functions.html">Functions</a></li>
<li><a href="../docs/python/googlestorage/exceptions.html">Exceptions</a></li>
    </li>


          </ul>
        </li>
        <li><a href="../docs/python/taskqueue/index.html">Task Queues</a>
          <ul>
                 <li><a href="../docs/python/taskqueue/overview.html">Overview</a></li>
     <li><a href="../docs/python/taskqueue/overview-push.html">Using Push Queues</a></li>
     <li><a href="../docs/python/taskqueue/overview-pull.html">Using Pull Queues</a><sup class="new">New!</sup></li>
     <li><span class="tlw-title tlw-expanded">Reference</span>
       <ul>
         <li><a href="../docs/python/taskqueue/tasks.html">Task Class</a></li>
         <li><a href="../docs/python/taskqueue/taskretryoptions.html">TaskRetryOptions Class</a></li>
         <li><a href="../docs/python/taskqueue/queues.html">Queue Class</a></li>
         <li><a href="../docs/python/taskqueue/rest.html">REST</a>  <span class="exp-feat">(Experimental)</span></li>
         <li><a href="../docs/python/taskqueue/functions.html">Functions</a></li>
         <li><a href="../docs/python/taskqueue/exceptions.html">Exceptions</a></li>
       </ul>
     </li>

          </ul>
        </li>
        <li><a href="../docs/python/urlfetch/index.html">URL Fetch</a>
          <ul>
                 <li><a href="../docs/python/urlfetch/overview.html">Overview</a></li>
     <li><span class="tlw-title tlw-expanded">Reference</span>
       <ul>
         <li><a href="../docs/python/urlfetch/fetchfunction.html">The fetch Function</a></li>
         <li><a href="../docs/python/urlfetch/asynchronousrequests.html">Asynchronous Requests</a></li>
         <li><a href="../docs/python/urlfetch/responseobjects.html">Response Objects</a></li>
         <li><a href="../docs/python/urlfetch/exceptions.html">Exceptions</a></li>
       </ul>
     </li>

          </ul>
        </li>
        <li><a href="../docs/python/users/index.html">Users</a>
          <ul>
                 <li><a href="../docs/python/users/overview.html">Overview</a></li>
     <li><a href="../docs/python/users/userobjects.html">User Objects</a></li>
     <li><a href="../docs/python/users/loginurls.html">Login URLs</a></li>
     <li><a href="../docs/python/users/adminusers.html">Admin Users</a></li>

     <li><span class="tlw-title tlw-expanded">Reference</span>
       <ul>
         <li><a href="../docs/python/users/userclass.html">User</a></li>
         <li><a href="../docs/python/users/functions.html">Functions</a></li>
         <li><a href="../docs/python/users/exceptions.html">Exceptions</a></li>
       </ul>
     </li>

          </ul>
        </li>
        <li><a href="../docs/python/xmpp/index.html">XMPP</a>
          <ul>
                 <li><a href="../docs/python/xmpp/overview.html">Overview</a></li>
     <li><span class="tlw-title tlw-expanded">Reference</span>
       <ul>
         <li><a href="../docs/python/xmpp/functions.html">Functions</a></li>
         <li><a href="../docs/python/xmpp/messageclass.html">Message</a></li>
         <li><a href="../docs/python/xmpp/exceptions.html">Exceptions</a></li>
       </ul>
     </li>

          </ul>
        </li>
      </ul>
    </li>
    <li><a href="../docs/python/config/index.html">Configuration</a>
      <ul>
            <li><a href="../docs/python/config/appconfig.html">App Config</a></li>
    <li><a href="../docs/python/config/backends.html">Backends Config</a></li>
    <li><a href="../docs/python/config/indexconfig.html">Index Config</a></li>
    <li><a href="../docs/python/config/cron.html">Scheduled Tasks</a></li>
    <li><a href="../docs/python/config/queue.html">Task Queue Config</a></li>
    <li><a href="../docs/python/config/dos.html">DoS Protection Config</a></li>

      </ul>
    </li>
    <li><span class="tlw-title"><a href="../docs/python/tools/index.html">Tools</a></span>
      <ul>
            <li><a href="../docs/python/tools/devserver.html">Development Server</a></li>
    <li><a href="../docs/python/tools/uploadinganapp.html">Uploading and Managing an App</a></li>
    <li><a href="../docs/python/tools/uploadingdata.html">Uploading and Downloading Data</a></li>
    <li><span class="tlw-title"><a href="../docs/python/tools/protorpc/index.html">ProtoRPC</a></span>
      <ul>
        <li><a href="../docs/python/tools/protorpc/overview.html">Overview</a></li>
<li><a href="../docs/python/tools/protorpc/definition-functions.html">Definition Module</a></li>
<li>Descriptor Module
  <ul>
        <li><a href="../docs/python/tools/protorpc/descriptor/descriptorlibrary.html">DescriptorLibrary Functions</a></li>
    <li><a href="../docs/python/tools/protorpc/descriptor/functions.html">Functions</a></li>

  </ul>
</li>
<li>Messages Module
  <ul>
        <li><a href="../docs/python/tools/protorpc/messages/enumclass.html">Enum</a></li>
    <li><a href="../docs/python/tools/protorpc/messages/enumfieldclass.html">EnumField</a></li>
    <li><a href="../docs/python/tools/protorpc/messages/fieldclass.html">Field</a></li>
    <li><a href="../docs/python/tools/protorpc/messages/fieldclasses.html">Message Field Classes</a></li>
    <li><a href="../docs/python/tools/protorpc/messages/messageclass.html">Message</a></li>
    <li><a href="../docs/python/tools/protorpc/messages/messagefieldclass.html">MessageField</a></li>
    <li><a href="../docs/python/tools/protorpc/messages/variantclass.html">Variant</a></li>
    <li><a href="../docs/python/tools/protorpc/messages/functions.html">Functions</a></li>
    <li><a href="../docs/python/tools/protorpc/messages/exceptions.html">Exceptions</a></li>
  </ul>
</li>
<li>Remote Service Library
  <ul>
        <li><a href="../docs/python/tools/protorpc/remote/index.html">Overview</a></li>
    <li><a href="../docs/python/tools/protorpc/remote/httprequeststateclass.html">HttpRequestState Class</a></li>
    <li><a href="../docs/python/tools/protorpc/remote/requeststateclass.html">RequestState Class</a></li>
    <li><a href="../docs/python/tools/protorpc/remote/rpcstatusclass.html">RpcStatus Class</a></li>
    <li><a href="../docs/python/tools/protorpc/remote/serviceclass.html">Service Class</a></li>
    <li><a href="../docs/python/tools/protorpc/remote/functions.html">Functions</a></li>
    <li><a href="../docs/python/tools/protorpc/remote/exceptions.html">Exceptions</a></li>

  </ul>
</li>
<li>Transport Library
  <ul>
        <li><a href="../docs/python/tools/protorpc/transport/httptransport.html">HttpTransport Class</a></li>
    <li><a href="../docs/python/tools/protorpc/transport/transport.html">Transport Class</a></li>

  </ul>
</li>
<li>WebApp Service Handlers
  <ul>
        <li><a href="../docs/python/tools/protorpc/webapp/index.html">Overview</a></li>
    <li><a href="../docs/python/tools/protorpc/webapp/functions.html">WebApp Service Handlers</a></li>

  </ul>
</li>

      </ul>
    </li>
    <li><a href="../docs/python/tools/webapp/index.html">webapp Framework</a>
      <ul>
             <li><a href="../docs/python/tools/webapp/overview.html">Overview</a></li>
     <li><a href="../docs/python/tools/webapp/running.html">Running the Application</a></li>
     <li><a href="../docs/python/tools/webapp/requesthandlers.html">Request Handlers</a></li>
     <li><a href="../docs/python/tools/webapp/requestdata.html">Request Data</a></li>
     <li><a href="../docs/python/tools/webapp/buildingtheresponse.html">Building the Response</a></li>
     <li><a href="../docs/python/tools/webapp/redirects.html">Redirects, Headers and Status Codes</a></li>
     <li><a href="../docs/python/tools/webapp/blobstorehandlers.html">Blobstore Handlers</a></li>

     <li><span class="tlw-title tlw-expanded">Reference</span>
       <ul>
         <li><a href="../docs/python/tools/webapp/requestclass.html">Request</a></li>
         <li><a href="../docs/python/tools/webapp/responseclass.html">Response</a></li>
         <li><a href="../docs/python/tools/webapp/requesthandlerclass.html">RequestHandler</a></li>
         <li><a href="../docs/python/tools/webapp/wsgiapplicationclass.html">WSGIApplication</a></li>
         <li><a href="../docs/python/tools/webapp/utilmodule.html">Utility Functions</a></li>
         
       </ul>
     </li>

      </ul>
    </li>
    <li><a href="../docs/python/tools/localunittesting.html">Local Unit Testing</a></li>
    <li><a href="../docs/python/tools/appstats.html">Appstats</a></li>
    <li><a href="../docs/python/tools/libraries.html">Included Libraries </a>(Python 2.5)</li>
    <li><a href="../docs/python/tools/libraries27.html">Included Libraries</a>(Python 2.7)</li>
    <li><a href="../docs/python/tools/appengineconfig.html">Python Module Configuration</a></li>

      </ul>
    </li>
    <li><a href="../docs/python/howto/index.html">How-To</a>
      <ul>
              <li><a href="../docs/python/howto/usinggdataservices.html">Google Data Services</a></li>
      <li><a href="../docs/python/howto/maintenance.html">Handling Scheduled Maintenance Periods</a></li>

      </ul>
    </li>

    </ul>
  </li>
</ul>
<div class="line"></div>
<ul>
  <li><h2>Go</h2> <span class="exp-feat">Experimental!</span>
    <ul>
          <li><a href="../docs/go/overview.html">Overview</a></li>
    <li><a href="../docs/go/runtime.html">Runtime Environment</a>
      <ul>
        <li><a href="../docs/go/reference.html">Reference</a></li>
      </ul>
    </li>
    <li><a href="../docs/go/backends/index.html">Backends</a>
      <ul>
        <li><a href="../docs/go/backends/overview.html">Overview</a></li>
<li><a href="../docs/go/backends/runtime.html">Runtime package</a></li>

      </ul>
    </li>
    <li><a href="../docs/go/datastore/index.html">Storing Data</a>
      <ul>
             <li><a href="../docs/go/datastore/overview.html">Overview</a></li>
     <li><a href="../docs/go/datastore/transactions.html">Transactions</a></li>
     <li><a href="../docs/go/datastore/reference.html">Reference</a></li>

      </ul>
    </li>
    <li><a href="../docs/go/apis.html">Services</a>
      <ul>
        <li><a href="../docs/go/blobstore/index.html">Blobstore</a>
          <ul>
            <li><a href="../docs/go/blobstore/overview.html">Overview</a></li>
<li><a href="../docs/go/blobstore/reference.html">Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/go/capabilities/index.html">Capabilities</a>
          <ul>
            <li><a href="../docs/go/capabilities/overview.html">Overview</a></li>
<li><a href="../docs/go/capabilities/reference.html">Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/go/channel/index.html">Channel</a>
          <ul>
            <li><a href="../docs/go/channel/overview.html">Overview</a></li>
<li><a href="../docs/go/channel/reference.html">Reference</a></li>
<li><a href="../docs/go/channel/javascript.html">Client Javascript Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/go/mail/index.html">Mail</a>
          <ul>
                 <li><a href="../docs/go/mail/overview.html">Overview</a></li>
     <li><a href="../docs/go/mail/reference.html">Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/go/memcache/index.html">Memcache</a>
          <ul>
                 <li><a href="../docs/go/memcache/overview.html">Overview</a></li>
     <li><a href="../docs/go/memcache/reference.html">Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/go/taskqueue/index.html">Task Queues</a>
          <ul>
                 <li><a href="../docs/go/taskqueue/overview.html">Overview</a></li>
     <li><a href="../docs/go/taskqueue/reference.html">Reference</a></li>
     <li><a href="../docs/go/taskqueue/delay.html">Delay package</a></li>

          </ul>
        </li>
        <li><a href="../docs/go/urlfetch/index.html">URL Fetch</a>
          <ul>
                 <li><a href="../docs/go/urlfetch/overview.html">Overview</a></li>
     <li><a href="../docs/go/urlfetch/reference.html">Reference</a></li>

          </ul>
        </li>
        <li><a href="../docs/go/users/index.html">Users</a>
          <ul>
                 <li><a href="../docs/go/users/overview.html">Overview</a></li>
     <li><a href="../docs/go/users/reference.html">Reference</a></li>

          </ul>
        </li>
      </ul>
        <li><a href="../docs/go/config/index.html">Configuration</a>
          <ul>
                <li><a href="../docs/go/config/appconfig.html">App Config</a></li>
    <li><a href="../docs/go/config/backends.html">Backends Config</a></li>
    <li><a href="../docs/go/config/indexconfig.html">Index Config</a></li>
    <li><a href="../docs/go/config/cron.html">Scheduled Tasks</a></li>
    <li><a href="../docs/go/config/queue.html">Task Queue Config</a></li>
    <li><a href="../docs/go/config/dos.html">DoS Protection Config</a></li>

          </ul>
        </li>
        <li><a href="../docs/go/tools/index.html">Tools</a>
          <ul>
                <li><a href="../docs/go/tools/devserver.html">Development Server</a></li>
    <li><a href="../docs/go/tools/uploadinganapp.html">Uploading and Managing an App</a></li>

          </ul>
        </li>
    </li>

    </ul>
  </li>
</ul>
<div class="line"></div>
<ul>
  <li><h2>Managing Your App</h2>
    <ul>
      <li><a href="../docs/adminconsole/index.html">Admin Console</a>
        <ul>
          <li><a href="../docs/adminconsole/instances.html">Instances</a></li>
<li><a href="../docs/adminconsole/roles.html">Roles</a></li>
<li><a href="../docs/adminconsole/applicationsettings.html">Application Settings</a></li>
<li><a href="../docs/adminconsole/datastoreadmin.html">Datastore</a></li>
<li><a href="../docs/adminconsole/performancesettings.html">Performance Settings</a></li>

        </ul>
      </li>
      <li><a href="../docs/quotas.html">Quotas</a></li>
      <li><a href="../docs/billing.html">Billing</a></li>
      <li><a href="../docs/premier/index.html">Premier Accounts</a></li>
      <li><a href="../docs/domain.html">Using a Custom Domain</a></li>
    </ul>
  </li>
</ul>
<div class="line"></div>
<ul>
  <li><h2>Resources</h2>
    <ul>
      <li><a href="../kb/index.html">FAQ</a></li>
      <li><a href="index.html">Articles</a></li>
      <li><a href="../docs/videoresources.html">Video Resources</a><sup class="new">New!</sup></li>
      <li><a href="http://code.google.com/p/googleappengine/">SDK Code</a></li>
      <li><a href="http://code.google.com/p/datanucleus-appengine/">JDO/JPA Code</a></li>
      <li><a href="http://code.google.com/p/google-app-engine-samples/">Sample Apps Code</a></li>
      <li>Launcher Code
        <ul>
          <li><a href="http://code.google.com/p/google-appengine-mac-launcher/">Mac</a></li>
          <li><a href="http://code.google.com/p/google-appengine-wx-launcher/">Windows/wx</a></li>
        </ul>
      </li>
      <li><a href="../community.html">Discussion Groups</a></li>
    </ul>
  </li>
</ul>
<div class="line"></div>
<ul>
  <li><a href="../docs/roadmap.html">Product Roadmap</a></li>
  <li><a href="http://code.google.com/p/googleappengine/wiki/SdkReleaseNotes">Release Notes: Python</a></li>
  <li><a href="http://code.google.com/p/googleappengine/wiki/SdkForJavaReleaseNotes">Release Notes: Java</a></li>
  <li><a href="../docs/revision_history.html">Revision History</a></li>
</ul>

        <a class="hidden" href="#gc-topnav-anchor">More Google App Engine resource links</a>
      </div>
      
      <a name="gc-pagecontent-anchor"></a>   
      <div class="g-unit" id="gc-pagecontent">
        <script type="text/javascript">CODESITE_docEarlyProcessing();</script>
        <h1 class="page_title">Sharding counters</h1>


<p class="nopadding"><em>Joe Gregorio<br/>October 2008</em>, updated <em>October 2011</em></p>

<div id="jd-content">
<div class="jd-descr">

<p class="note" align="center">This is part four of a five-part <a href="scaling/overview.html">series</a> on effectively scaling your App Engine-based apps. To see the other articles in the series, see <a href="#related">Related links</a>.</p>

<p>When developing an efficient application on Google App Engine,
you need to pay attention to how often an entity is updated. While
App Engine's datastore scales to support a huge number of
entities, it is important to note that you can only expect to update
any single entity or entity group about five times a second. That
is an estimate and the actual update rate for an entity is dependent on several attributes of the entity, including how many
properties it has, how large it is, and how many indexes
need updating. While a single entity or entity group has a
limit on how quickly it can be updated, App Engine excels at
handling many parallel requests distributed across distinct
entities, and we can take advantage of this by using
sharding.</p>

<p>The question is, what if you had an entity that you wanted to
update faster than five times a second? For example, you might count
the number of votes in a poll, the number of comments, or even the number of visitors to your site. Take
this simple example:</p>

<div class="tabpane">
  <ul>
    <li><a href="#counter_python"><span>Python</span></a></li>
    <li><a href="#counter_java"><span>Java (JDO)</span></a></li>
    <li><a href="#counter_go"><span>Go</span></a></li>
  </ul>
  <div class="content-container">
    <div id="counter_python">
      <pre class="prettyprint">
class Counter(db.Model):
  count = db.IntegerProperty()
      </pre>
    </div>
    <div id="counter_java">
      <pre class="prettyprint">
@PersistenceCapable(identityType = IdentityType.APPLICATION)
public class Counter {
  @PrimaryKey
  @Persistent(valueStrategy = IdGeneratorStrategy.IDENTITY)
  private Long id;

  @Persistent
  private Integer count;

  public Long getId() {
    return id;
  }

  public Integer getCount() {
    return count;
  }

  // ...
}
      </pre>
    </div>
    <div id="counter_go">
      <pre class="prettyprint">
type Counter struct {
    Count int
}
      </pre>
    </div>
  </div>
</div>

<p>If you had a single entity that was the counter and the update rate
was too fast, then you would have contention as the serialized
writes would stack up and start to timeout. The way to solve this
problem is a little counter-intuitive if you are coming from a
relational database; the solution relies on the fact that reads
from the App Engine datastore are extremely fast and cheap since
entities that have been recently read or updated are cached in
memory. The way to reduce the contention is to build a sharded
counter &ndash; break the counter up into <code>N</code> different counters. When you
want to increment the counter, you pick one of the shards at random
and increment it. When you want to know the total count,
you read all of the counter shards and sum up their individual counts. The
more shards you have, the higher the throughput you will have for
increments on your counter. This technique works for a lot more
than just counters and an important skill to learn is spotting the
entities in your application with a lot of writes and then finding
good ways to shard them.</p>

<p>Here is a very simple implementation of a sharded counter:</p>

<div class="tabpane">
  <ul>
    <li><a href="#impl_python"><span>Python</span></a></li>
    <li><a href="#impl_java"><span>Java</span></a></li>
    <li><a href="#impl_jdo"><span>Java (JDO)</span></a></li>
    <li><a href="#impl_go"><span>Go</span></a></li>
  </ul>
  <div class="content-container">
    <div id="impl_python">
      <pre class="prettyprint">
from google.appengine.ext import db
import random

class SimpleCounterShard(db.Model):
    """Shards for the counter"""
    count = db.IntegerProperty(required=True, default=0)

NUM_SHARDS = 20

def get_count():
    """Retrieve the value for a given sharded counter."""
    total = 0
    for counter in SimpleCounterShard.all():
        total += counter.count
    return total

def increment():
    """Increment the value for a given sharded counter."""
    def txn():
        index = random.randint(0, NUM_SHARDS - 1)
        shard_name = "shard" + str(index)
        counter = SimpleCounterShard.get_by_key_name(shard_name)
        if counter is None:
            counter = SimpleCounterShard(key_name=shard_name)
        counter.count += 1
        counter.put()
    db.run_in_transaction(txn)
      </pre>
    </div>
    <div id="impl_java">
      <pre class="prettyprint">
import com.google.appengine.api.datastore.DatastoreService;
import com.google.appengine.api.datastore.DatastoreServiceFactory;
import com.google.appengine.api.datastore.Entity;
import com.google.appengine.api.datastore.EntityNotFoundException;
import com.google.appengine.api.datastore.Key;
import com.google.appengine.api.datastore.KeyFactory;
import com.google.appengine.api.datastore.Query;
import com.google.appengine.api.datastore.Transaction;

import java.util.Random;

/**
 * This initial implementation simply counts all instances of the
 * SimpleCounterShard kind in the datastore. The only way to increment the
 * number of shards is to add another shard by creating another entity in the
 * datastore.
 */
public class ShardedCounterV1 {

  private static final DatastoreService ds = DatastoreServiceFactory
      .getDatastoreService();

  /**
   * Default number of shards.
   */
  private static final int NUM_SHARDS = 20;

  /**
   * A random number generator, for distributing writes across shards.
   */
  private final Random generator = new Random();

  /**
   * Retrieve the value of this sharded counter.
   *
   * @return Summed total of all shards' counts
   */
  public long getCount() {
    long sum = 0;

    Query query = new Query("SimpleCounterShard");
    for (Entity e : ds.prepare(query).asIterable()) {
      sum += (Long) e.getProperty("count");
    }

    return sum;
  }

  /**
   * Increment the value of this sharded counter.
   */
  public void increment() {
    int shardNum = generator.nextInt(NUM_SHARDS);
    Key shardKey = KeyFactory.createKey("SimpleCounterShard",
        Integer.toString(shardNum));

    Transaction tx = ds.beginTransaction();
    Entity shard;
    try {
      shard = ds.get(tx, shardKey);
      long count = (Long) shard.getProperty("count");
      shard.setUnindexedProperty("count", count + 1L);
    } catch (EntityNotFoundException e) {
      shard = new Entity(shardKey);
      shard.setUnindexedProperty("count", 1L);
    }
    ds.put(tx, shard);
    tx.commit();
  }
}
      </pre>
    </div>
    <div id="impl_jdo">
      <pre class="prettyprint">
import PMF;

import java.util.List;
import java.util.Random;

import javax.jdo.PersistenceManager;

/**
 * This initial implementation simply counts all instances of the
 * SimpleCounterShard class in the datastore. The only way to increment the
 * number of shards is to add another shard by creating another entity in the
 * datastore
 */
public class ShardedCounter {

  private static final int NUM_SHARDS = 20;

  /**
   * Retrieve the value of this sharded counter.
   *
   * @return Summed total of all shards' counts
   */
  public int getCount() {
    int sum = 0;
    PersistenceManager pm = PMF.get().getPersistenceManager();

    try {
      String query = "select from " + SimpleCounterShard.class.getName();
      List&lt;SimpleCounterShard&gt; shards =
          (List&lt;SimpleCounterShard&gt;) pm.newQuery(query).execute();
      if (shards != null && !shards.isEmpty()) {
        for (SimpleCounterShard shard : shards) {
          sum += shard.getCount();
        }
      }
    } finally {
      pm.close();
    }

    return sum;
  }

  /**
   * Increment the value of this sharded counter.
   */
  public void increment() {
    PersistenceManager pm = PMF.get().getPersistenceManager();

    Random generator = new Random();
    int shardNum = generator.nextInt(NUM_SHARDS);

    try {
      Query shardQuery = pm.newQuery(SimpleCounterShard.class);
      shardQuery.setFilter("shardNumber == numParam");
      shardQuery.declareParameters("int numParam");

      List&lt;SimpleCounterShard&gt; shards =
          (List&lt;SimpleCounterShard&gt;) shardQuery.execute(shardNum);
      SimpleCounterShard shard;

      // If the shard with the passed shard number exists, increment its count
      // by 1. Otherwise, create a new shard object, set its count to 1, and
      // persist it.
      if (shards != null && !shards.isEmpty()) {
        shard = shards.get(0);
        shard.setCount(shard.getCount() + 1);
      } else {
        shard = new SimpleCounterShard();
        shard.setShardNumber(shardNum);
        shard.setCount(1);
      }

      pm.makePersistent(shard);
    } finally {
      pm.close();
    }
  }
}
      </pre>
    </div>
    <div id="impl_go">
      <pre class="prettyprint">
package sharded_counter

import (
    "appengine"
    "appengine/datastore"
    "fmt"
    "os"
    "rand"
)

type simpleCounterShard struct {
    Count int
}

const (
    numShards = 20
    shardKind = "SimpleCounterShard"
)

// Count retrieves the value of the counter.
func Count(c appengine.Context) (int, os.Error) {
    total := 0
    q := datastore.NewQuery(shardKind)
    for t := q.Run(c); ; {
        var s simpleCounterShard
        _, err := t.Next(&s)
        if err == datastore.Done {
            break
        }
        if err != nil {
            return total, err
        }
        total += s.Count
    }
    return total, nil
}

// Increment increments the counter.
func Increment(c appengine.Context) os.Error {
    return datastore.RunInTransaction(c, func(c appengine.Context) os.Error {
        shardName := fmt.Sprintf("shard%d", rand.Intn(numShards))
        key := datastore.NewKey(c, shardKind, shardName, 0, nil)
        var s simpleCounterShard
        err := datastore.Get(c, key, &s)
        // A missing entity and a present entity will both work.
        if err != nil && err != datastore.ErrNoSuchEntity {
            return err
        }
        s.Count++
        _, err = datastore.Put(c, key, &s)
        return err
    }, nil)
}
      </pre>
    </div>
  </div>
</div>

<p>In <code>get_count()</code> (Python), <code>getCount()</code> (Java) and <code>Count()</code> (Go),
we simply loop over all the shards and add up
the individual shard counts. In <code>increment()</code> (Python and Java) and <code>Increment()</code> (Go),
we choose a shard at random and then read,
increment, and write it back to the datastore.
</p>

<p>Note that we create the shards lazily, only creating them when they
are first incremented. The lazy creation of the shards allows the
number of shards to be increased (but never decreased) in the
future if more are needed. The value of <code>NUM_SHARDS</code>/<code>numShards</code> could be doubled
and the results from <code>get_count()</code>/<code>Count()</code> would not change since the
query only selects the shards that have been added to the
datastore, and <code>increment()</code>/<code>Increment()</code> will lazily create shards that aren't
there.</p>

<p>That is useful as an example to learn from, but a more general
purpose counter would allow you to create named counters on the
fly, increase the number of shards dynamically, and use memcache to
speed up reads to shards. The exampe code that
<a href="http://sites.google.com/site/io/building-scalable-web-applications-with-google-app-engine">
Brett Slatkin gave in his Google I/O talk</a> does just that
and I've included that code here, along with a function to increase
the number of shards for a particular counter:
</p>

<div class="tabpane">
  <ul>
    <li><a href="#implv2_python"><span>Python</span></a></li>
    <li><a href="#implv2_java"><span>Java</span></a></li>
    <li><a href="#implv2_jdo"><span>Java (JDO)</span></a></li>
    <li><a href="#implv2_go"><span>Go</span></a></li>
  </ul>
  <div class="content-container">
    <div id="implv2_python">
      <pre class="prettyprint">
from google.appengine.api import memcache
from google.appengine.ext import db
import random

class GeneralCounterShardConfig(db.Model):
    """Tracks the number of shards for each named counter."""
    name = db.StringProperty(required=True)
    num_shards = db.IntegerProperty(required=True, default=20)


class GeneralCounterShard(db.Model):
    """Shards for each named counter"""
    name = db.StringProperty(required=True)
    count = db.IntegerProperty(required=True, default=0)


def get_count(name):
    """Retrieve the value for a given sharded counter.

    Parameters:
      name - The name of the counter
    """
    total = memcache.get(name)
    if total is None:
        total = 0
        for counter in GeneralCounterShard.all().filter('name = ', name):
            total += counter.count
        memcache.add(name, total, 60)
    return total


def increment(name):
    """Increment the value for a given sharded counter.

    Parameters:
      name - The name of the counter
    """
    config = GeneralCounterShardConfig.get_or_insert(name, name=name)
    def txn():
        index = random.randint(0, config.num_shards - 1)
        shard_name = name + str(index)
        counter = GeneralCounterShard.get_by_key_name(shard_name)
        if counter is None:
            counter = GeneralCounterShard(key_name=shard_name, name=name)
        counter.count += 1
        counter.put()
    db.run_in_transaction(txn)
    # does nothing if the key does not exist
    memcache.incr(name)


def increase_shards(name, num):
    """Increase the number of shards for a given sharded counter.
    Will never decrease the number of shards.

    Parameters:
      name - The name of the counter
      num - How many shards to use

    """
    config = GeneralCounterShardConfig.get_or_insert(name, name=name)
    def txn():
        if config.num_shards &lt; num:
            config.num_shards = num
            config.put()
    db.run_in_transaction(txn)
      </pre>
    </div>
    <div id="implv2_java">
      <pre class="prettyprint">
import com.google.appengine.api.datastore.DatastoreService;
import com.google.appengine.api.datastore.DatastoreServiceFactory;
import com.google.appengine.api.datastore.Entity;
import com.google.appengine.api.datastore.EntityNotFoundException;
import com.google.appengine.api.datastore.Key;
import com.google.appengine.api.datastore.KeyFactory;
import com.google.appengine.api.datastore.Query;
import com.google.appengine.api.datastore.Transaction;
import com.google.appengine.api.memcache.Expiration;
import com.google.appengine.api.memcache.MemcacheService;
import com.google.appengine.api.memcache.MemcacheService.SetPolicy;
import com.google.appengine.api.memcache.MemcacheServiceFactory;

import java.util.Random;

/**
 * A counter which can be incremented rapidly.
 *
 * Capable of incrementing the counter and increasing the number of shards. When
 * incrementing, a random shard is selected to prevent a single shard from being
 * written too frequently. If increments are being made too quickly, increase
 * the number of shards to divide the load. Performs datastore operations using
 * the low level datastore API.
 */
public class ShardedCounter {

  /**
   * Convenience class which contains constants related to a named sharded
   * counter. The counter name provided in the constructor is used as
   * the entity key.
   */
  private static final class Counter {
    /**
     * Entity kind representing a named sharded counter.
     */
    private static final String KIND = "Counter";

    /**
     * Property to store the number of shards in a given {@value #KIND} named
     * sharded counter.
     */
    private static final String SHARD_COUNT = "shard_count";
  }

  /**
   * Convenience class which contains constants related to the counter shards.
   * The shard number (as a String) is used as the entity key.
   */
  private static final class CounterShard {
    /**
     * Entity kind prefix, which is concatenated with the counter name to form
     * the final entity kind, which represents counter shards.
     */
    private static final String KIND_PREFIX = "CounterShard_";

    /**
     * Property to store the current count within a counter shard.
     */
    private static final String COUNT = "count";
  }

  private static final DatastoreService ds = DatastoreServiceFactory
      .getDatastoreService();

  /**
   * Default number of shards.
   */
  private static final int INITIAL_SHARDS = 5;

  /**
   * The name of this counter.
   */
  private final String counterName;

  /**
   * A random number generating, for distributing writes across shards.
   */
  private final Random generator = new Random();

  /**
   * The counter shard kind for this counter.
   */
  private String kind;

  private final MemcacheService mc = MemcacheServiceFactory
      .getMemcacheService();

  /**
   * Constructor which creates a sharded counter using the provided counter
   * name.
   *
   * @param counterName name of the sharded counter
   */
  public ShardedCounter(String counterName) {
    this.counterName = counterName;
    kind = CounterShard.KIND_PREFIX + counterName;
  }

  /**
   * Increase the number of shards for a given sharded counter. Will never
   * decrease the number of shards.
   *
   * @param count Number of new shards to build and store
   */
  public void addShards(int count) {
    Key counterKey = KeyFactory.createKey(Counter.KIND, counterName);
    incrementPropertyTx(counterKey, Counter.SHARD_COUNT, count, INITIAL_SHARDS
        + count);
  }

  /**
   * Retrieve the value of this sharded counter.
   *
   * @return Summed total of all shards' counts
   */
  public long getCount() {
    Long value = (Long) mc.get(kind);
    if (value != null) {
      return value;
    }

    long sum = 0;
    Query query = new Query(kind);
    for (Entity shard : ds.prepare(query).asIterable()) {
      sum += (Long) shard.getProperty(CounterShard.COUNT);
    }
    mc.put(kind, sum, Expiration.byDeltaSeconds(60),
        SetPolicy.ADD_ONLY_IF_NOT_PRESENT);

    return sum;
  }

  /**
   * Increment the value of this sharded counter.
   */
  public void increment() {
    // Find how many shards are in this counter.
    int numShards = getShardCount();

    // Choose the shard randomly from the available shards.
    long shardNum = generator.nextInt(numShards);

    Key shardKey = KeyFactory.createKey(kind, Long.toString(shardNum));
    incrementPropertyTx(shardKey, CounterShard.COUNT, 1, 1);
    mc.increment(kind, 1);
  }

  /**
   * Get the number of shards in this counter.
   *
   * @return shard count
   */
  private int getShardCount() {
    try {
      Key counterKey = KeyFactory.createKey(Counter.KIND, counterName);
      Entity counter = ds.get(counterKey);
      Long shardCount = (Long) counter.getProperty(Counter.SHARD_COUNT);
      return shardCount.intValue();
    } catch (EntityNotFoundException ignore) {
      return INITIAL_SHARDS;
    }
  }

  /**
   * Increment datastore property value inside a transaction. If the entity with
   * the provided key does not exist, instead create an entity with the supplied
   * initial property value.
   *
   * @param key the entity key to update or create
   * @param prop the property name to be incremented
   * @param increment the amount by which to increment
   * @param initialValue the value to use if the entity does not exist
   */
  private void incrementPropertyTx(Key key, String prop, long increment,
      long initialValue) {
    Transaction tx = ds.beginTransaction();
    Entity thing;
    long value;
    try {
      thing = ds.get(tx, key);
      value = (Long) thing.getProperty(prop) + increment;
    } catch (EntityNotFoundException e) {
      thing = new Entity(key);
      value = initialValue;
    }
    thing.setUnindexedProperty(prop, value);
    ds.put(tx, thing);
    tx.commit();
  }
}
      </pre>
    </div>
    <div id="implv2_jdo">
      <pre class="prettyprint">
import PMF;

import java.util.List;
import java.util.Random;
import javax.jdo.PersistenceManager;
import javax.jdo.Query;

/**
 * A counter which can be incremented rapidly.
 *
 * Capable of incrementing the counter and increasing the number of shards.
 * When incrementing, a random shard is selected to prevent a single shard
 * from being written to too frequently. If increments are being made too
 * quickly, increase the number of shards to divide the load. Performs
 * datastore operations using JDO.
 */
public class ShardedCounter {
  private String counterName;

  public ShardedCounter(String counterName) {
    this.counterName = counterName;
  }

  public String getCounterName() {
    return counterName;
  }

  /**
   * Retrieve the value of this sharded counter.
   *
   * @return Summed total of all shards' counts
   */
  public int getCount() {
    int sum = 0;
    PersistenceManager pm = PMF.get().getPersistenceManager();

    try {
      Query shardsQuery =
          pm.newQuery(GeneralCounterShard.class, "counterName == nameParam");
      shardsQuery.declareParameters("String nameParam");

      List&lt;GeneralCounterShard&gt; shards =
          (List&lt;GeneralCounterShard&gt;) shardsQuery.execute(counterName);
      if (shards != null && !shards.isEmpty()) {
        for (GeneralCounterShard current : shards) {
          sum += current.getCount();
        }
      }
    } finally {
      pm.close();
    }

    return sum;
  }

  /**
   * Increment the value of this sharded counter.
   */
  public void increment() {
    PersistenceManager pm = PMF.get().getPersistenceManager();

    // Find how many shards are in this counter.
    int shardCount = 0;
    try {
      Counter current = getThisCounter(pm);
      shardCount = current.getShardCount();
    } finally {
      pm.close();
    }

    // Choose the shard randomly from the available shards.
    Random generator = new Random();
    int shardNum = generator.nextInt(shardCount);

    pm = PMF.get().getPersistenceManager();
    try {
      Query randomShardQuery = pm.newQuery(GeneralCounterShard.class);
      randomShardQuery.setFilter(
          "counterName == nameParam && shardNumber == numParam");
      randomShardQuery.declareParameters("String nameParam, int numParam");

      List&lt;GeneralCounterShard&gt; shards = (List&lt;GeneralCounterShard&gt;)
          randomShardQuery.execute(counterName, shardNum);
      if (shards != null && !shards.isEmpty()) {
        GeneralCounterShard shard = shards.get(0);
        shard.increment(1);
        pm.makePersistent(shard);
      }
    } finally {
      pm.close();
    }
  }

  /**
   * Increase the number of shards for a given sharded counter.
   * Will never decrease the number of shards.
   *
   * @param  count Number of new shards to build and store
   * @return Total number of shards
   */
  public int addShards(int count) {
    PersistenceManager pm = PMF.get().getPersistenceManager();

    // Find the initial shard count for this counter.
    int numShards = 0;
    try {
      Counter current = getThisCounter(pm);
      if (current != null) {
        numShards = current.getShardCount().intValue();
        current.setShardCount(numShards + count);
        // Save the increased shard count for this counter.
        pm.makePersistent(current);
      }
    } finally {
      pm.close();
    }

    // Create new shard objects for this counter.
    pm = PMF.get().getPersistenceManager();
    try {
      for (int i = 0; i &lt; count; i++) {
        GeneralCounterShard newShard =
            new GeneralCounterShard(getCounterName(), numShards);
        pm.makePersistent(newShard);
        numShards++;
      }
    } finally {
      pm.close();
    }

    return numShards;
  }

  /**
   * @return Counter datastore object matching this object's counterName value
   */
  private Counter getThisCounter(PersistenceManager pm) {
    Counter current = null;

    Query thisCounterQuery =
        pm.newQuery(Counter.class, "counterName == nameParam");
    thisCounterQuery.declareParameters("String nameParam");

    List&lt;Counter&gt; counter =
        (List&lt;Counter&gt;) thisCounterQuery.execute(counterName);
    if (counter != null && !counter.isEmpty()) {
      current = counter.get(0);
    }

    return current;
  }
}
      </pre>
    </div>
    <div id="implv2_go">
      <pre class="prettyprint">
package sharded_counter

import (
    "appengine"
    "appengine/datastore"
    "appengine/memcache"
    "fmt"
    "os"
    "rand"
)

type counterConfig struct {
    Shards int
}

type shard struct {
    Name  string
    Count int
}

const (
    defaultShards = 20
    configKind    = "GeneralCounterShardConfig"
    shardKind     = "GeneralCounterShard"
)

func memcacheKey(name string) string {
    return shardKind + ":" + name
}

// Count retrieves the value of the named counter.
func Count(c appengine.Context, name string) (int, os.Error) {
    total := 0
    mkey := memcacheKey(name)
    if _, err := memcache.JSON.Get(c, mkey, &total); err == nil {
        return total, nil
    }
    q := datastore.NewQuery(shardKind).Filter("Name =", name)
    for t := q.Run(c); ; {
        var s shard
        _, err := t.Next(&s)
        if err == datastore.Done {
            break
        }
        if err != nil {
            return total, err
        }
        total += s.Count
    }
    memcache.JSON.Set(c, &memcache.Item{
        Key:        mkey,
        Object:     &total,
        Expiration: 60,
    })
    return total, nil
}

// Increment increments the named counter.
func Increment(c appengine.Context, name string) os.Error {
    // Get counter config.
    var cfg counterConfig
    ckey := datastore.NewKey(c, configKind, name, 0, nil)
    err := datastore.RunInTransaction(c, func(c appengine.Context) os.Error {
        err := datastore.Get(c, ckey, &cfg)
        if err == datastore.ErrNoSuchEntity {
            cfg.Shards = defaultShards
            _, err = datastore.Put(c, ckey, &cfg)
        }
        return err
    })
    if err != nil {
        return err
    }
    err = datastore.RunInTransaction(c, func(c appengine.Context) os.Error {
        shardName := fmt.Sprintf("shard%d", rand.Intn(cfg.Shards))
        key := datastore.NewKey(c, shardKind, shardName, 0, nil)
        var s shard
        err := datastore.Get(c, key, &s)
        // A missing entity and a present entity will both work.
        if err != nil && err != datastore.ErrNoSuchEntity {
            return err
        }
        s.Count++
        _, err = datastore.Put(c, key, &s)
        return err
    }, nil)
    if err != nil {
        return err
    }
    memcache.Increment(c, memcacheKey(name), 1, 0)
    return nil
}

// IncreaseShards increases the number of shards for the named counter to n.
// It will never decrease the number of shards.
func IncreaseShards(c appengine.Context, name string, n int) os.Error {
    ckey := datastore.NewKey(c, configKind, name, 0, nil)
    return datastore.RunInTransaction(c, func(c appengine.Context) os.Error {
        var cfg counterConfig
        mod := false
        err := datastore.Get(c, ckey, &cfg)
        if err == datastore.ErrNoSuchEntity {
            cfg.Shards = defaultShards
            mod = true
        } else if err != nil {
            return err
        }
        if cfg.Shards < n {
            cfg.Shards = n
            mod = true
        }
        if mod {
            _, err = datastore.Put(c, ckey, &cfg)
        }
        return err
    }, nil)
}
      </pre>
    </div>
  </div>
</div>

<h2 id="source">Source</h2>
<p>The Python source for both counters described above is available in the
<a href="http://code.google.com/p/google-app-engine-samples/source/checkout">
Google App Engine Samples project</a> as <code>sharded-counters</code>.
The Java source is available in the <code>demos</code> directory of the
<a href="http://code.google.com/p/googleappengine/source/checkout">Google App
Engine SDK project</a> as <code>shardedcounter</code>, or in the
<a href="http://code.google.com/p/google-app-engine-samples/source/checkout">
Google App Engine Samples project</a> as <code>sharded-counters-java</code>.
While the web interface to the examples
isn't much to look at, it's instructive to use the admin interface
an inspect the data models after you have incremented both counters
a few times.</p>

<h2 id="conclusion">Conclusion</h2>
<p>Sharding is one of many important techniques in building a
scalable application and hopefully these examples will give you
ideas of where you apply the technique in your application.
The code in these articles is available under the Apache 2
license so feel free to start with them as you build your
solutions.</p>

<h2 id="more-info">More Info</h2>
<p>Watch Brett Slatkin's Google I/O talk
"<a href="http://sites.google.com/site/io/building-scalable-web-applications-with-google-app-engine">Building
Scalable Web Applications with Google AppEngine</a>".</p>

<h2 id="related">Related links</h2>

<ul>
  <li><a href="scaling/overview.html">Overview</a></li>
  <li><a href="scaling/minimize.html">Minimizing work</a></li>
  <li><a href="paging.html">Paging in App Engine</a></li>
  <li><a href="scaling/contention.html">Avoiding datastore contention</a></li>
  <li><a href="sharding_counters.html">Sharding counters</a></li>
  <li><a href="scaling/memcache.html">Effective memcache</a></li>
</ul>


</div></div>
   
      </div><!-- end gc-pagecontent -->
   </div><!-- end gooey wrapper -->

    </div> <!-- end codesite content -->


<div id="gc-footer" dir="ltr">
  <div class="text">
    
      <div class="notice"><div id="notice" style="text-align: center; border: 1em 0em 1em 0em">
  Except as otherwise <a
  href="http://code.google.com/policies.html#restrictions">noted</a>,
  the content of this page is licensed under the <a rel="license"
  href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
  Attribution 3.0 License</a>, and code samples are licensed under the
  <a rel="license" href="http://www.apache.org/licenses/LICENSE-2.0">Apache
  2.0 License</a>.
<!-- <rdf:RDF xmlns="http://web.resource.org/cc/" 
              xmlns:dc="http://purl.org/dc/elements/1.1/"
              xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
  <Work rdf:about="">
    <license rdf:resource="http://creativecommons.org/licenses/by/3.0/" />
  </Work>
  <License rdf:about="http://creativecommons.org/licenses/by/3.0/">
    <permits rdf:resource="http://web.resource.org/cc/Reproduction"/>
    <permits rdf:resource="http://web.resource.org/cc/Distribution"/>
    <requires rdf:resource="http://web.resource.org/cc/Notice"/>
    <requires rdf:resource="http://web.resource.org/cc/Attribution"/>
    <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks"/>
  </License>
</rdf:RDF> -->
</div>
Java is a registered trademark of Oracle Corporation and/or its affiliates</div>
    
    ©2011 Google -
    <a href="http://code.google.com">Code Home</a> -
    <a href="http://code.google.com/terms.html">Site Terms of Service</a> -
    <a href="http://code.google.com/privacy.html">Privacy Policy</a> -
    <a href="http://code.google.com/more">Site Directory</a>
    <br> <br>
    Google Code offered in:
    <a href="http://code.google.com/intl/en">English</a> -
    <a href="http://code.google.com/intl/es">Español</a> -
    <a href="http://code.google.com/intl/ja">日本語</a> -
    <a href="http://code.google.com/intl/ko">한국어</a> -
    <a href="http://code.google.com/intl/pt-BR">Português</a> -
    <a href="http://code.google.com/intl/ru">Pусский</a> -
    <a href="http://code.google.com/intl/zh-CN">中文(简体)</a> -
    <a href="http://code.google.com/intl/zh-TW">中文(繁體)</a>
  </div>
</div><!-- end gc-footer -->

</div><!-- end gc-container -->

<script type="text/javascript">CODESITE_CSITimer['load'].tick('ats');</script>
<script src="../../js/codesite_tail.pack.04102009.js" type="text/javascript"></script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>





  </body>
</html>


